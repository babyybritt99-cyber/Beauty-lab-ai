<!doctype html>
<html>
<head>

<meta charset="utf-8">

<title>Beauty Lab AI</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

body{
font-family:Arial;
background:#111;
color:white;
text-align:center;
padding:20px;
}

button{
padding:12px;
font-size:16px;
margin:10px;
background:#2b5cff;
color:white;
border:none;
border-radius:10px;
}

.card{
max-width:700px;
margin:auto;
margin-bottom:20px;
padding:15px;
border-radius:12px;
background:#151515;
border:1px solid #222;
text-align:left;
}

canvas{
width:100%;
max-width:500px;
border-radius:10px;
margin-top:10px;
}

pre{
white-space:pre-wrap;
background:#0c0c0c;
padding:10px;
border-radius:10px;
border:1px solid #222;
}

.historyItem{

background:#0c0c0c;
margin-top:10px;
padding:10px;
border-radius:10px;
border:1px solid #222;

}

</style>

</head>

<body>

<h1>Beauty Lab AI</h1>

<p>Private AI Beauty Lab</p>

<div class="card">

<h2>Analyze Photo</h2>

<input id="photo" type="file" accept="image/*">

<br>

<button id="analyze">Analyze Photo</button>

<button id="export">Export History</button>

<canvas id="canvas"></canvas>

<h3>Results</h3>

<pre id="results">

Upload a photo to begin.

</pre>

</div>

<div class="card">

<h2>History</h2>

<button id="refresh">Refresh</button>

<button id="clear">Clear History</button>

<div id="history"></div>

</div>

<script>

// DATABASE

const DB="beautylab"

const STORE="results"

function openDB(){

return new Promise(resolve=>{

const req=indexedDB.open(DB,1)

req.onupgradeneeded=()=>{

req.result.createObjectStore(STORE,{keyPath:"id"})

}

req.onsuccess=()=>resolve(req.result)

})

}

async function saveData(data){

const db=await openDB()

const tx=db.transaction(STORE,"readwrite")

tx.objectStore(STORE).put(data)

}

async function getData(){

const db=await openDB()

return new Promise(resolve=>{

const tx=db.transaction(STORE,"readonly")

const req=tx.objectStore(STORE).getAll()

req.onsuccess=()=>resolve(req.result)

})

}

async function clearData(){

const db=await openDB()

const tx=db.transaction(STORE,"readwrite")

tx.objectStore(STORE).clear()

}


// UI

const photo=document.getElementById("photo")

const analyze=document.getElementById("analyze")

const canvas=document.getElementById("canvas")

const results=document.getElementById("results")

const historyDiv=document.getElementById("history")

const refresh=document.getElementById("refresh")

const clearBtn=document.getElementById("clear")

const exportBtn=document.getElementById("export")

let imageBitmap


photo.onchange=async()=>{

const file=photo.files[0]

imageBitmap=await createImageBitmap(file)

const ctx=canvas.getContext("2d")

canvas.width=imageBitmap.width

canvas.height=imageBitmap.height

ctx.drawImage(imageBitmap,0,0)

}


// ANALYSIS ENGINE

analyze.onclick=async()=>{

const ctx=canvas.getContext("2d")

const img=ctx.getImageData(0,0,canvas.width,canvas.height)

let brightness=0
let redness=0
let shine=0

for(let i=0;i<img.data.length;i+=4){

const r=img.data[i]
const g=img.data[i+1]
const b=img.data[i+2]

const lum=(r+g+b)/3

brightness+=lum

redness+=r-(g+b)/2

if(lum>235) shine++

}

const px=img.data.length/4

brightness/=px
redness/=px

const oiliness=shine/px


// FIXED SCORE SYSTEM

const skinScore=Math.max(
0,
Math.min(
100,
Math.round(
100
- redness*0.6
- (120-brightness)*0.4
)
)
)

const glowScore=Math.round(
(skinScore+80)/2
)



results.innerText=`

Skin Score: ${skinScore}

Glow Score: ${glowScore}

Brightness: ${Math.round(brightness)}

Redness Index: ${Math.round(redness)}

Oiliness Index:

${oiliness.toFixed(4)}

All analysis runs locally.
Photos never uploaded.

`


// SAVE HISTORY

await saveData({

id:Date.now(),

date:new Date().toLocaleString(),

skinScore,

glowScore,

brightness,

redness,

oiliness

})

renderHistory()

}


// HISTORY DISPLAY

async function renderHistory(){

const data=await getData()

historyDiv.innerHTML=""

data.reverse().forEach(d=>{

const div=document.createElement("div")

div.className="historyItem"

div.innerHTML=`

<b>${d.date}</b>

<br>

Skin Score: ${d.skinScore}

<br>

Glow Score: ${d.glowScore}

`

historyDiv.appendChild(div)

})

}


refresh.onclick=renderHistory


clearBtn.onclick=async()=>{

await clearData()

renderHistory()

}


exportBtn.onclick=async()=>{

const data=await getData()

const blob=new Blob([JSON.stringify(data,null,2)])

const url=URL.createObjectURL(blob)

const a=document.createElement("a")

a.href=url

a.download="beauty-history.json"

a.click()

}


renderHistory()

</script>

</body>

</html>
